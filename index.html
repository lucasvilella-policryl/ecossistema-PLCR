<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Estoque Policryl</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #334155 0%, #1e293b 100%);
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 20px rgba(0,0,0,0.15);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 4px;
        }

        .sidebar-header p {
            font-size: 13px;
            color: #94a3b8;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .nav-item:hover {
            background: #475569;
            color: white;
        }

        .nav-item.active {
            background: #10b981;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .header p {
            font-size: 14px;
            color: #64748b;
        }

        .header-actions {
            margin-top: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
        }

        /* Alert */
        .alert {
            padding: 16px 24px;
            margin: 0 32px 0 32px;
            margin-top: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            animation: slideDown 0.3s;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .stat-card.blue {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .stat-card.gray {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.2);
        }

        .stat-card.yellow {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .stat-card.red {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }

        .stat-card h3 {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 700;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            padding: 14px 20px;
            text-align: left;
            font-size: 11px;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
            color: #334155;
        }

        tbody tr:hover {
            background: #f8fafc;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .product-img {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            object-fit: cover;
        }

        .img-placeholder {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-blue {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-purple {
            background: #e9d5ff;
            color: #6b21a8;
        }

        .badge-green {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-red {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-gray {
            background: #f3f4f6;
            color: #4b5563;
        }

        /* Consulta Box */
        .consulta-box {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .consulta-search {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        .consulta-search input {
            flex: 1;
            padding: 14px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
        }

        .consulta-result {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .info-card {
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .info-card.highlight {
            background: #d1fae5;
            border-color: #6ee7b7;
        }

        .info-card label {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 6px;
            display: block;
        }

        .info-card .value {
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
        }

        .info-card.highlight .value {
            color: #065f46;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.3;
        }

        /* Form Card */
        .form-card {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
        }

        .form-card h3 {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 24px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .btn-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            padding: 8px;
            background: none;
            border: none;
            cursor: pointer;
            color: #3b82f6;
            transition: color 0.2s;
        }

        .icon-btn:hover {
            color: #2563eb;
        }

        .icon-btn.delete {
            color: #ef4444;
        }

        .icon-btn.delete:hover {
            color: #dc2626;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }

            .sidebar-header h1,
            .sidebar-header p,
            .nav-item span {
                display: none;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .content-area {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>Policryl</h1>
                <p>Sistema de Estoque</p>
            </div>
            <nav class="sidebar-nav" id="sidebar-nav">
                <!-- Itens do menu ser√£o injetados aqui -->
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header" id="header">
                <!-- Conte√∫do do header ser√° injetado aqui -->
            </header>

            <!-- Alert -->
            <div id="alert-container"></div>

            <!-- Content Area -->
            <main class="content-area" id="content-area">
                <!-- Conte√∫do ser√° injetado aqui -->
            </main>
        </div>
    </div>

    <script>
        // ==================== STORAGE ====================
        const storage = {
            get(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Erro ao ler storage:', error);
                    return null;
                }
            },
            set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error('Erro ao salvar storage:', error);
                    return false;
                }
            },
            remove(key) {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    console.error('Erro ao remover storage:', error);
                    return false;
                }
            }
        };

        // ==================== STATE ====================
        let state = {
            activeTab: 'dashboard',
            produtos: [],
            movimentacoes: [],
            responsaveis: [],
            linhas: [],
            searchTerm: '',
            filterStatus: 'todos',
            filterLinha: 'todas',
            sortBy: 'status',
            sortOrder: 'asc',
            consultaSKU: '',
            editingItem: null
        };

        // ==================== INIT DATA ====================
        function initData() {
            let produtos = storage.get('policryl-produtos');
            let movimentacoes = storage.get('policryl-movimentacoes');
            let responsaveis = storage.get('policryl-responsaveis');
            let linhas = storage.get('policryl-linhas');

            if (!produtos) {
                produtos = [
                ];
                storage.set('policryl-produtos', produtos);
            }

            if (!movimentacoes) {
                movimentacoes = [];
                storage.set('policryl-movimentacoes', movimentacoes);
            }

            if (!responsaveis) {
                responsaveis = [
                ];
                storage.set('policryl-responsaveis', responsaveis);
            }

            if (!linhas) {
                linhas = [
                ];
                storage.set('policryl-linhas', linhas);
            }

            state.produtos = produtos;
            state.movimentacoes = movimentacoes;
            state.responsaveis = responsaveis;
            state.linhas = linhas;
        }

        // ==================== HELPERS ====================
        function getStatusProduto(produto) {
            if (produto.quantidade < produto.estoqueMinimo) return 'abaixo';
            if (produto.quantidade <= produto.estoqueMinimo * 1.2) return 'proximo';
            return 'ok';
        }

        function getStatusLabel(status) {
            const labels = {
                'abaixo': 'Abaixo do M√≠nimo',
                'proximo': 'Pr√≥ximo do M√≠nimo',
                'ok': 'OK'
            };
            return labels[status] || 'OK';
        }

        function calcularEstatisticas() {
            const total = state.produtos.length;
            const ativos = state.produtos.filter(p => p.ativo).length;
            const inativos = state.produtos.filter(p => !p.ativo).length;
            const ok = state.produtos.filter(p => getStatusProduto(p) === 'ok').length;
            const proximo = state.produtos.filter(p => getStatusProduto(p) === 'proximo').length;
            const abaixo = state.produtos.filter(p => getStatusProduto(p) === 'abaixo').length;

            return { total, ativos, inativos, ok, proximo, abaixo };
        }

        function showAlert(message, type = 'success') {
            const container = document.getElementById('alert-container');
            container.innerHTML = `
                <div class="alert alert-${type}">
                    <span>${message}</span>
                </div>
            `;
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }

        function exportarExcel() {
            const produtosFiltrados = getProdutosFiltrados();
            const csv = [
                ['SKU', 'Descri√ß√£o', 'Linha', 'Quantidade', 'M√≠nimo', 'Status', '√öltima Atualiza√ß√£o'],
                ...produtosFiltrados.map(p => [
                    p.sku,
                    p.descricao,
                    p.linha,
                    p.quantidade,
                    p.estoqueMinimo,
                    getStatusLabel(getStatusProduto(p)),
                    new Date(p.ultimaAtualizacao).toLocaleDateString('pt-BR')
                ])
            ].map(row => row.join(';')).join('\n');

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `estoque_policryl_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            showAlert('Relat√≥rio exportado com sucesso!');
        }

        function getProdutosFiltrados() {
            return state.produtos
                .filter(p => {
                    const matchSearch = p.sku.toLowerCase().includes(state.searchTerm.toLowerCase()) || 
                                       p.descricao.toLowerCase().includes(state.searchTerm.toLowerCase());
                    const matchStatus = state.filterStatus === 'todos' || 
                                       (state.filterStatus === 'ativo' && p.ativo) ||
                                       (state.filterStatus === 'inativo' && !p.ativo) ||
                                       getStatusProduto(p) === state.filterStatus;
                    const matchLinha = state.filterLinha === 'todas' || p.linha === state.filterLinha;
                    
                    return matchSearch && matchStatus && matchLinha;
                })
                .sort((a, b) => {
                    if (state.sortBy === 'status') {
                        const statusOrder = { 'abaixo': 0, 'proximo': 1, 'ok': 2 };
                        return statusOrder[getStatusProduto(a)] - statusOrder[getStatusProduto(b)];
                    } else if (state.sortBy === 'quantidade') {
                        return state.sortOrder === 'asc' ? a.quantidade - b.quantidade : b.quantidade - a.quantidade;
                    }
                    return 0;
                });
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderSidebar() {
            const nav = document.getElementById('sidebar-nav');
            const menuItems = [
                { id: 'dashboard', label: 'Status do Estoque', icon: 'üìä' },
                { id: 'consulta', label: 'Consultar Produto', icon: 'üîç' },
                { id: 'estoque', label: 'Estoque Geral', icon: 'üì¶' },
                { id: 'movimentacoes', label: 'Movimenta√ß√µes', icon: 'üìã' },
                { id: 'nova-movimentacao', label: 'Cadastrar Movimenta√ß√£o', icon: 'üìà' },
                { id: 'novo-produto', label: 'Cadastrar Produto', icon: '‚ûï' },
                { id: 'novo-responsavel', label: 'Cadastrar Respons√°vel', icon: 'üë•' },
                { id: 'nova-linha', label: 'Cadastrar Linha', icon: 'üè∑Ô∏è' }
            ];

            nav.innerHTML = menuItems.map(item => `
                <button class="nav-item ${state.activeTab === item.id ? 'active' : ''}" onclick="changeTab('${item.id}')">
                    <span>${item.icon}</span>
                    <span>${item.label}</span>
                </button>
            `).join('');
        }

        function renderHeader() {
            const header = document.getElementById('header');
            const titles = {
                'dashboard': 'Status do Estoque',
                'consulta': 'Consultar Produto',
                'estoque': 'Estoque Geral',
                'movimentacoes': 'Movimenta√ß√µes',
                'nova-movimentacao': 'Cadastrar Movimenta√ß√£o',
                'novo-produto': 'Cadastrar Produto',
                'novo-responsavel': 'Cadastrar Respons√°vel',
                'nova-linha': 'Cadastrar Linha'
            };

            const stats = calcularEstatisticas();
            const subtitles = {
                'dashboard': `${stats.total} produtos cadastrados`,
                'estoque': `${stats.ativos} produtos ativos`,
                'movimentacoes': `${state.movimentacoes.length} movimenta√ß√µes registradas`
            };

            header.innerHTML = `
                <h2>${titles[state.activeTab]}</h2>
                <p>${subtitles[state.activeTab] || ''}</p>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="exportarExcel()">
                        üì• Exportar
                    </button>
                </div>
            `;
        }

        function renderDashboard() {
            const stats = calcularEstatisticas();
            const produtosFiltrados = getProdutosFiltrados();

            return `
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <h3>Produtos Cadastrados</h3>
                        <div class="value">${stats.total}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Produtos Ativos</h3>
                        <div class="value">${stats.ativos}</div>
                    </div>
                    <div class="stat-card gray">
                        <h3>Produtos Inativos</h3>
                        <div class="value">${stats.inativos}</div>
                    </div>
                    <div class="stat-card">
                        <h3>Estoque OK</h3>
                        <div class="value">${stats.ok}</div>
                    </div>
                    <div class="stat-card yellow">
                        <h3>Pr√≥ximo do M√≠nimo</h3>
                        <div class="value">${stats.proximo}</div>
                    </div>
                    <div class="stat-card red">
                        <h3>Abaixo do M√≠nimo</h3>
                        <div class="value">${stats.abaixo}</div>
                    </div>
                </div>

                <div class="filters">
                    <div class="filters-grid">
                        <div class="form-group">
                            <label>Buscar</label>
                            <input type="text" placeholder="SKU ou descri√ß√£o..." value="${state.searchTerm}" oninput="state.searchTerm = this.value; render()">
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select onchange="state.filterStatus = this.value; render()">
                                <option value="todos" ${state.filterStatus === 'todos' ? 'selected' : ''}>Todos</option>
                                <option value="ativo" ${state.filterStatus === 'ativo' ? 'selected' : ''}>Ativos</option>
                                <option value="inativo" ${state.filterStatus === 'inativo' ? 'selected' : ''}>Inativos</option>
                                <option value="abaixo" ${state.filterStatus === 'abaixo' ? 'selected' : ''}>Abaixo do M√≠nimo</option>
                                <option value="proximo" ${state.filterStatus === 'proximo' ? 'selected' : ''}>Pr√≥ximo do M√≠nimo</option>
                                <option value="ok" ${state.filterStatus === 'ok' ? 'selected' : ''}>OK</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Linha</label>
                            <select onchange="state.filterLinha = this.value; render()">
                                <option value="todas" ${state.filterLinha === 'todas' ? 'selected' : ''}>Todas</option>
                                ${state.linhas.map(l => `<option value="${l.nome}" ${state.filterLinha === l.nome ? 'selected' : ''}>${l.nome}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ordenar por Quantidade</label>
                            <div class="btn-group">
                                <button class="btn ${state.sortBy === 'quantidade' && state.sortOrder === 'asc' ? 'btn-primary' : 'btn-secondary'}" onclick="state.sortBy = 'quantidade'; state.sortOrder = 'asc'; render()">Crescente</button>
                                <button class="btn ${state.sortBy === 'quantidade' && state.sortOrder === 'desc' ? 'btn-primary' : 'btn-secondary'}" onclick="state.sortBy = 'quantidade'; state.sortOrder = 'desc'; render()">Decrescente</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>SKU</th>
                                <th>Descri√ß√£o</th>
                                <th>Linha</th>
                                <th>Quantidade</th>
                                <th>M√≠nimo</th>
                                <th>Status</th>
                                <th>Ativo</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${produtosFiltrados.map(p => `
                                <tr>
                                    <td>
                                        ${p.foto ? 
                                            `<img src="${p.foto}" class="product-img" alt="${p.descricao}">` : 
                                            `<div class="img-placeholder">üì¶</div>`
                                        }
                                    </td>
                                    <td><strong>${p.sku}</strong></td>
                                    <td>${p.descricao}</td>
                                    <td><span class="badge badge-blue">${p.linha}</span></td>
                                    <td><strong>${p.quantidade}</strong></td>
                                    <td>${p.estoqueMinimo}</td>
                                    <td>
                                        <span class="badge badge-${getStatusProduto(p) === 'ok' ? 'success' : getStatusProduto(p) === 'proximo' ? 'warning' : 'danger'}">
                                            ${getStatusLabel(getStatusProduto(p))}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge ${p.ativo ? 'badge-green' : 'badge-gray'}">
                                            ${p.ativo ? '‚úì Sim' : '‚úó N√£o'}
                                        </span>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderConsulta() {
            const produto = state.produtos.find(p => p.sku.toLowerCase() === state.consultaSKU.toLowerCase());

            return `
                <div class="consulta-box">
                    <div class="consulta-search">
                        <input type="text" placeholder="Ex: XXX-XX-XXXX" value="${state.consultaSKU}" oninput="state.consultaSKU = this.value">
                        <button class="btn btn-primary" onclick="render()">üîç Buscar</button>
                    </div>

                    ${produto ? `
                        <div class="consulta-result">
                            <div class="info-card">
                                <label>SKU</label>
                                <div class="value">${produto.sku}</div>
                            </div>
                            <div class="info-card">
                                <label>Descri√ß√£o</label>
                                <div class="value">${produto.descricao}</div>
                            </div>
                            <div class="info-card">
                                <label>Linha</label>
                                <div class="value">${produto.linha}</div>
                            </div>
                            <div class="info-card">
                                <label>Status</label>
                                <div class="value">${produto.ativo ? 'Ativo' : 'Inativo'}</div>
                            </div>
                            <div class="info-card highlight">
                                <label>Quantidade Atual</label>
                                <div class="value">${produto.quantidade}</div>
                            </div>
                            <div class="info-card">
                                <label>Quantidade M√≠nima</label>
                                <div class="value">${produto.estoqueMinimo}</div>
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <label style="display: block; margin-bottom: 12px; font-weight: 600;">N√≠vel no Estoque</label>
                            <span class="badge badge-${getStatusProduto(produto) === 'ok' ? 'success' : getStatusProduto(produto) === 'proximo' ? 'warning' : 'danger'}" style="font-size: 16px; padding: 10px 20px;">
                                ${getStatusLabel(getStatusProduto(produto))}
                            </span>
                        </div>
                    ` : state.consultaSKU ? `
                        <div class="empty-state">
                            <p style="font-size: 18px; font-weight: 600;">Nenhum produto encontrado</p>
                            <p style="margin-top: 8px;">Verifique o SKU e tente novamente</p>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <p style="font-size: 18px; font-weight: 600;">Digite um SKU para consultar</p>
                        </div>
                    `}
                </div>
            `;
        }

        function renderEstoqueGeral() {
            return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Foto</th>
                                <th>SKU</th>
                                <th>Descri√ß√£o</th>
                                <th>Linha</th>
                                <th>Quantidade Atual</th>
                                <th>√öltima Atualiza√ß√£o</th>
                                <th>M√≠nimo Ideal</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.produtos.map(p => `
                                <tr>
                                    <td>
                                        ${p.foto ? 
                                            `<img src="${p.foto}" class="product-img" alt="${p.descricao}">` : 
                                            `<div class="img-placeholder">üì¶</div>`
                                        }
                                    </td>
                                    <td><strong>${p.sku}</strong></td>
                                    <td>${p.descricao}</td>
                                    <td><span class="badge badge-blue">${p.linha}</span></td>
                                    <td><strong>${p.quantidade}</strong></td>
                                    <td>${new Date(p.ultimaAtualizacao).toLocaleDateString('pt-BR')}</td>
                                    <td>${p.estoqueMinimo}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderMovimentacoes() {
            return `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Hor√°rio</th>
                                <th>Foto</th>
                                <th>SKU</th>
                                <th>Descri√ß√£o</th>
                                <th>Linha</th>
                                <th>Tipo</th>
                                <th>Quantidade</th>
                                <th>Pedido</th>
                                <th>Respons√°vel</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.movimentacoes.length === 0 ? `
                                <tr>
                                    <td colspan="10" style="text-align: center; padding: 60px 20px; color: #94a3b8;">
                                        <p style="font-size: 18px; font-weight: 600;">Nenhuma movimenta√ß√£o registrada</p>
                                    </td>
                                </tr>
                            ` : state.movimentacoes.map(m => `
                                <tr>
                                    <td>${m.data}</td>
                                    <td>${m.horario}</td>
                                    <td>
                                        ${m.foto ? 
                                            `<img src="${m.foto}" class="product-img" alt="${m.descricao}">` : 
                                            `<div class="img-placeholder">üì¶</div>`
                                        }
                                    </td>
                                    <td><strong>${m.sku}</strong></td>
                                    <td>${m.descricao}</td>
                                    <td><span class="badge badge-blue">${m.linha}</span></td>
                                    <td>
                                        <span class="badge ${m.tipo === 'entrada' ? 'badge-green' : 'badge-red'}">
                                            ${m.tipo === 'entrada' ? '‚Üë Entrada' : '‚Üì Sa√≠da'}
                                        </span>
                                    </td>
                                    <td><strong>${m.tipo === 'entrada' ? '+' : '-'}${m.quantidade}</strong></td>
                                    <td>${m.pedido || '-'}</td>
                                    <td>${m.responsavel}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderNovaMovimentacao() {
            return `
                <div class="form-card">
                    <form onsubmit="salvarMovimentacao(event); return false;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Data</label>
                                <input type="text" value="${new Date().toLocaleDateString('pt-BR')}" disabled>
                            </div>
                            <div class="form-group">
                                <label>Hor√°rio</label>
                                <input type="text" value="${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}" disabled>
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>SKU *</label>
                                <select id="mov-sku" required>
                                    <option value="">Selecione um produto...</option>
                                    ${state.produtos.filter(p => p.ativo).map(p => `
                                        <option value="${p.sku}">${p.sku} - ${p.descricao}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Tipo de Movimenta√ß√£o *</label>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-primary" id="tipo-entrada" onclick="setTipoMovimento('entrada')">‚Üë Entrada</button>
                                    <button type="button" class="btn btn-secondary" id="tipo-saida" onclick="setTipoMovimento('saida')">‚Üì Sa√≠da</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Quantidade *</label>
                                <input type="number" id="mov-quantidade" min="1" required>
                            </div>
                            <div class="form-group">
                                <label>Pedido do Movimento</label>
                                <input type="text" id="mov-pedido" placeholder="Ex: #12345">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Respons√°vel *</label>
                                <select id="mov-responsavel" required>
                                    <option value="">Selecione um respons√°vel...</option>
                                    ${state.responsaveis.filter(r => r.ativo).map(r => `
                                        <option value="${r.nome} ${r.sobrenome}">${r.nome} ${r.sobrenome} - ${r.departamento}</option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px;">
                            üíæ Registrar Movimenta√ß√£o
                        </button>
                    </form>
                </div>
            `;
        }

        function renderNovoProduto() {
            return `
                <div class="form-card">
                    <h3>${state.editingItem ? 'Editar Produto' : 'Novo Produto'}</h3>
                    <form onsubmit="salvarProduto(event); return false;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>SKU *</label>
                                <input type="text" id="prod-sku" placeholder="Ex: XXX-XX-XXXX" value="${state.editingItem?.sku || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Descri√ß√£o *</label>
                                <input type="text" id="prod-descricao" placeholder="Nome do produto" value="${state.editingItem?.descricao || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Linha *</label>
                                <select id="prod-linha" required>
                                    <option value="">Selecione uma linha...</option>
                                    ${state.linhas.map(l => `
                                        <option value="${l.nome}" ${state.editingItem?.linha === l.nome ? 'selected' : ''}>${l.nome}</option>
                                    `).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Estoque Inicial</label>
                                <input type="number" id="prod-estoque" min="0" value="${state.editingItem?.quantidade || 0}">
                            </div>
                            <div class="form-group">
                                <label>Estoque M√≠nimo</label>
                                <input type="number" id="prod-minimo" min="0" value="${state.editingItem?.estoqueMinimo || 0}">
                            </div>
                            <div class="form-group">
                                <label>URL da Foto</label>
                                <input type="url" id="prod-foto" placeholder="https://..." value="${state.editingItem?.foto || ''}">
                            </div>
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Status</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="prod-ativo" value="true" ${!state.editingItem || state.editingItem.ativo ? 'checked' : ''}> Ativo
                                    </label>
                                    <label>
                                        <input type="radio" name="prod-ativo" value="false" ${state.editingItem && !state.editingItem.ativo ? 'checked' : ''}> Inativo
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ ${state.editingItem ? 'Atualizar' : 'Cadastrar'} Produto
                            </button>
                            ${state.editingItem ? `
                                <button type="button" class="btn btn-secondary" onclick="state.editingItem = null; render()">
                                    Cancelar
                                </button>
                            ` : ''}
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <h3 style="font-size: 18px; font-weight: 700;">Produtos Cadastrados</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Descri√ß√£o</th>
                                <th>Linha</th>
                                <th>Quantidade</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.produtos.map(p => `
                                <tr>
                                    <td><strong>${p.sku}</strong></td>
                                    <td>${p.descricao}</td>
                                    <td><span class="badge badge-blue">${p.linha}</span></td>
                                    <td><strong>${p.quantidade}</strong></td>
                                    <td>
                                        <span class="badge ${p.ativo ? 'badge-green' : 'badge-gray'}">
                                            ${p.ativo ? '‚úì Ativo' : '‚úó Inativo'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="icon-btn" onclick="editarProduto('${p.id}')">‚úèÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderNovoResponsavel() {
            return `
                <div class="form-card">
                    <h3>${state.editingItem ? 'Editar Respons√°vel' : 'Novo Respons√°vel'}</h3>
                    <form onsubmit="salvarResponsavel(event); return false;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Nome *</label>
                                <input type="text" id="resp-nome" placeholder="Nome" value="${state.editingItem?.nome || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Sobrenome *</label>
                                <input type="text" id="resp-sobrenome" placeholder="Sobrenome" value="${state.editingItem?.sobrenome || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Departamento *</label>
                                <input type="text" id="resp-departamento" placeholder="Ex: Estoque, Comercial" value="${state.editingItem?.departamento || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <div class="radio-group">
                                    <label>
                                        <input type="radio" name="resp-ativo" value="true" ${!state.editingItem || state.editingItem.ativo ? 'checked' : ''}> Ativo
                                    </label>
                                    <label>
                                        <input type="radio" name="resp-ativo" value="false" ${state.editingItem && !state.editingItem.ativo ? 'checked' : ''}> Inativo
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ ${state.editingItem ? 'Atualizar' : 'Cadastrar'} Respons√°vel
                            </button>
                            ${state.editingItem ? `
                                <button type="button" class="btn btn-secondary" onclick="state.editingItem = null; render()">
                                    Cancelar
                                </button>
                            ` : ''}
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <h3 style="font-size: 18px; font-weight: 700;">Respons√°veis Cadastrados</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Sobrenome</th>
                                <th>Departamento</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.responsaveis.map(r => `
                                <tr>
                                    <td><strong>${r.nome}</strong></td>
                                    <td>${r.sobrenome}</td>
                                    <td><span class="badge badge-purple">${r.departamento}</span></td>
                                    <td>
                                        <span class="badge ${r.ativo ? 'badge-green' : 'badge-gray'}">
                                            ${r.ativo ? '‚úì Ativo' : '‚úó Inativo'}
                                        </span>
                                    </td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="icon-btn" onclick="editarResponsavel('${r.id}')">‚úèÔ∏è</button>
                                            <button class="icon-btn delete" onclick="deletarResponsavel('${r.id}')">üóëÔ∏è</button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function renderNovaLinha() {
            return `
                <div class="form-card">
                    <h3>${state.editingItem ? 'Editar Linha' : 'Nova Linha'}</h3>
                    <form onsubmit="salvarLinha(event); return false;">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>C√≥digo da Linha *</label>
                                <input type="text" id="linha-codigo" placeholder="SKU da Linha" value="${state.editingItem?.codigo || ''}" required>
                            </div>
                            <div class="form-group">
                                <label>Nome da Linha *</label>
                                <input type="text" id="linha-nome" placeholder="Descri√ß√£o da Linha" value="${state.editingItem?.nome || ''}" required>
                            </div>
                        </div>
                        <div style="display: flex; gap: 12px; margin-top: 24px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ ${state.editingItem ? 'Atualizar' : 'Cadastrar'} Linha
                            </button>
                            ${state.editingItem ? `
                                <button type="button" class="btn btn-secondary" onclick="state.editingItem = null; render()">
                                    Cancelar
                                </button>
                            ` : ''}
                        </div>
                    </form>
                </div>

                <div class="table-container">
                    <div style="padding: 20px; border-bottom: 1px solid #e2e8f0;">
                        <h3 style="font-size: 18px; font-weight: 700;">Linhas Cadastradas</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nome da Linha</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.linhas.map(l => `
                                <tr>
                                    <td><strong>${l.codigo}</strong></td>
                                    <td><span class="badge badge-blue">${l.nome}</span></td>
                                    <td>
                                        <div style="display: flex; gap: 8px;">
                                            <button class="icon-btn" onclick="editarLinha('${l.id}')">‚úèÔ∏è</button>
                                            <button class="icon-btn delete" onclick="deletarLinha('${l.id}')">üóëÔ∏è</button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // ==================== ACTIONS ====================
        let tipoMovimento = 'entrada';

        function setTipoMovimento(tipo) {
            tipoMovimento = tipo;
            document.getElementById('tipo-entrada').className = tipo === 'entrada' ? 'btn btn-primary' : 'btn btn-secondary';
            document.getElementById('tipo-saida').className = tipo === 'saida' ? 'btn btn-primary' : 'btn btn-secondary';
        }

        function salvarMovimentacao(e) {
            e.preventDefault();
            const sku = document.getElementById('mov-sku').value;
            const quantidade = parseInt(document.getElementById('mov-quantidade').value);
            const pedido = document.getElementById('mov-pedido').value;
            const responsavel = document.getElementById('mov-responsavel').value;

            const produto = state.produtos.find(p => p.sku === sku);
            if (!produto) {
                showAlert('Produto n√£o encontrado', 'error');
                return;
            }

            const novaQuantidade = tipoMovimento === 'entrada' ? produto.quantidade + quantidade : produto.quantidade - quantidade;
            if (novaQuantidade < 0) {
                showAlert('Quantidade insuficiente em estoque', 'error');
                return;
            }

            const novaMovimentacao = {
                id: Date.now().toString(),
                sku,
                descricao: produto.descricao,
                linha: produto.linha,
                foto: produto.foto,
                tipo: tipoMovimento,
                quantidade,
                pedido,
                responsavel,
                data: new Date().toLocaleDateString('pt-BR'),
                horario: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
            };

            state.movimentacoes = [novaMovimentacao, ...state.movimentacoes];
            state.produtos = state.produtos.map(p => 
                p.sku === sku ? { ...p, quantidade: novaQuantidade, ultimaAtualizacao: new Date().toISOString() } : p
            );

            storage.set('policryl-movimentacoes', state.movimentacoes);
            storage.set('policryl-produtos', state.produtos);

            showAlert('Movimenta√ß√£o registrada com sucesso!');
            e.target.reset();
            tipoMovimento = 'entrada';
            render();
        }

        function salvarProduto(e) {
            e.preventDefault();
            const sku = document.getElementById('prod-sku').value;
            const descricao = document.getElementById('prod-descricao').value;
            const linha = document.getElementById('prod-linha').value;
            const estoqueInicial = parseInt(document.getElementById('prod-estoque').value) || 0;
            const estoqueMinimo = parseInt(document.getElementById('prod-minimo').value) || 0;
            const foto = document.getElementById('prod-foto').value;
            const ativo = document.querySelector('input[name="prod-ativo"]:checked').value === 'true';

            if (state.editingItem) {
                state.produtos = state.produtos.map(p => 
                    p.id === state.editingItem.id 
                        ? { ...p, sku, descricao, linha, estoqueMinimo, foto, ativo, ultimaAtualizacao: new Date().toISOString() }
                        : p
                );
                showAlert('Produto atualizado com sucesso!');
                state.editingItem = null;
            } else {
                const novoProduto = {
                    id: Date.now().toString(),
                    sku,
                    descricao,
                    linha,
                    quantidade: estoqueInicial,
                    estoqueMinimo,
                    foto,
                    ativo,
                    ultimaAtualizacao: new Date().toISOString()
                };
                state.produtos.push(novoProduto);
                showAlert('Produto cadastrado com sucesso!');
            }

            storage.set('policryl-produtos', state.produtos);
            e.target.reset();
            render();
        }

        function salvarResponsavel(e) {
            e.preventDefault();
            const nome = document.getElementById('resp-nome').value;
            const sobrenome = document.getElementById('resp-sobrenome').value;
            const departamento = document.getElementById('resp-departamento').value;
            const ativo = document.querySelector('input[name="resp-ativo"]:checked').value === 'true';

            if (state.editingItem) {
                state.responsaveis = state.responsaveis.map(r => 
                    r.id === state.editingItem.id ? { ...r, nome, sobrenome, departamento, ativo } : r
                );
                showAlert('Respons√°vel atualizado com sucesso!');
                state.editingItem = null;
            } else {
                const novoResponsavel = {
                    id: Date.now().toString(),
                    nome,
                    sobrenome,
                    departamento,
                    ativo
                };
                state.responsaveis.push(novoResponsavel);
                showAlert('Respons√°vel cadastrado com sucesso!');
            }

            storage.set('policryl-responsaveis', state.responsaveis);
            e.target.reset();
            render();
        }

        function salvarLinha(e) {
            e.preventDefault();
            const codigo = document.getElementById('linha-codigo').value;
            const nome = document.getElementById('linha-nome').value;

            if (state.editingItem) {
                state.linhas = state.linhas.map(l => 
                    l.id === state.editingItem.id ? { ...l, codigo, nome } : l
                );
                showAlert('Linha atualizada com sucesso!');
                state.editingItem = null;
            } else {
                const novaLinha = {
                    id: Date.now().toString(),
                    codigo,
                    nome
                };
                state.linhas.push(novaLinha);
                showAlert('Linha cadastrada com sucesso!');
            }

            storage.set('policryl-linhas', state.linhas);
            e.target.reset();
            render();
        }

        function editarProduto(id) {
            const produto = state.produtos.find(p => p.id === id);
            state.editingItem = produto;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            render();
        }

        function editarResponsavel(id) {
            const responsavel = state.responsaveis.find(r => r.id === id);
            state.editingItem = responsavel;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            render();
        }

        function editarLinha(id) {
            const linha = state.linhas.find(l => l.id === id);
            state.editingItem = linha;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            render();
        }

        function deletarResponsavel(id) {
            if (confirm('Tem certeza que deseja excluir este respons√°vel?')) {
                state.responsaveis = state.responsaveis.filter(r => r.id !== id);
                storage.set('policryl-responsaveis', state.responsaveis);
                showAlert('Respons√°vel exclu√≠do com sucesso!');
                render();
            }
        }

        function deletarLinha(id) {
            if (confirm('Tem certeza que deseja excluir esta linha?')) {
                state.linhas = state.linhas.filter(l => l.id !== id);
                storage.set('policryl-linhas', state.linhas);
                showAlert('Linha exclu√≠da com sucesso!');
                render();
            }
        }

        function changeTab(tab) {
            state.activeTab = tab;
            state.editingItem = null;
            render();
        }

        // ==================== RENDER ====================
        function render() {
            renderSidebar();
            renderHeader();

            const contentArea = document.getElementById('content-area');
            
            switch(state.activeTab) {
                case 'dashboard':
                    contentArea.innerHTML = renderDashboard();
                    break;
                case 'consulta':
                    contentArea.innerHTML = renderConsulta();
                    break;
                case 'estoque':
                    contentArea.innerHTML = renderEstoqueGeral();
                    break;
                case 'movimentacoes':
                    contentArea.innerHTML = renderMovimentacoes();
                    break;
                case 'nova-movimentacao':
                    contentArea.innerHTML = renderNovaMovimentacao();
                    setTimeout(() => setTipoMovimento('entrada'), 0);
                    break;
                case 'novo-produto':
                    contentArea.innerHTML = renderNovoProduto();
                    break;
                case 'novo-responsavel':
                    contentArea.innerHTML = renderNovoResponsavel();
                    break;
                case 'nova-linha':
                    contentArea.innerHTML = renderNovaLinha();
                    break;
            }
        }

        // ==================== INIT ====================
        initData();
        render();
    </script>
</body>
</html>

